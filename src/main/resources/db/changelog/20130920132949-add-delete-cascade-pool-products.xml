<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <changeSet id="20130920132949" author="jesusr">
        <comment>Drop the pool id fk constraint</comment>
        <!-- See http://www.liquibase.org/manual/refactoring_commands -->
        <dropForeignKeyConstraint baseTableName="cp_pool_products"
            constraintName="fk_pool_provided_product"/>

        <addForeignKeyConstraint baseColumnNames="pool_id" baseTableName="cp_pool_products"
            baseTableSchemaName="public" constraintName="fk_pool_provided_product"
            deferrable="false" initiallyDeferred="false" onDelete="CASCADE" onUpdate="NO ACTION"
            referencedColumnNames="id" referencedTableName="cp_pool"
            referencedTableSchemaName="public" referencesUniqueColumn="false"/>

        <dropForeignKeyConstraint baseTableName="cp_product_pool_attribute"
            constraintName="fk_prdct_pool_attrib_pool_id"/>

        <addForeignKeyConstraint baseColumnNames="pool_id" baseTableName="cp_product_pool_attribute"
            constraintName="fk_prdct_pool_attrib_pool_id" deferrable="false"
            initiallyDeferred="false" onDelete="CASCADE" referencedColumnNames="id"
            referencedTableName="cp_pool" referencesUniqueColumn="false"/>
    </changeSet>

</databaseChangeLog>
