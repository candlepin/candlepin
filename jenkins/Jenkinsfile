library identifier: 'fh-pipeline-library@master', retriever: modernSCM(
  [$class: 'GitSCMSource',
   remote: 'https://github.com/januson/fh-pipeline-library.git',
   credentialsId: 'github-api-token-as-username-password',
   ])

pipeline {
    agent none
    options {
        skipDefaultCheckout true
        timeout(time: 16, unit: 'HOURS')
        disableConcurrentBuilds(abortPrevious: true)
    }
    stages {
        stage('Trust') {
            agent none
            steps {
                enforceTrustedApproval("candlepin","rhsm-jenkins-github-app")
            }
        }
        stage('Test') {
            parallel {
                stage('checkstyle') {
                    agent { label 'candlepin' }
                    steps {
                        sh 'sudo chown -R jenkins:jenkins $WORKSPACE'
                        checkout scm
                        sh 'sh jenkins/lint.sh'
                    }
                    post {
                        always {
                            sh 'sh jenkins/cleanup.sh'
                        }
                    }
                }
            }
        }
    }
}
